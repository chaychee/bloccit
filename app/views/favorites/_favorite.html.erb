<% if policy(Favorite.new).create? %>
  <%= content_tag :div, class: 'favorite', id: "favorite-#{post.id}" do %>

    <% if favorite = current_user.favorited(post) %>
      <%= link_to [post, favorite], method: :delete, remote: true, class: 'btn btn-danger' do %>
        <i class="glyphicon glyphicon-star-empty"> </i>&nbsp; Unfavorite
      <% end %>
    <% else %>
      <%= link_to [post, Favorite.new], method: :post, remote: true, class: 'btn btn-primary' do %>
        <i class="glyphicon glyphicon-star"> </i>&nbsp; Favorite
      <% end %>
    <% end %>
  
  <% end %>
<% end %>